<html>
  <head>
    <title>Track vaccine slot</title> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
      #pin {
        height: 30px;
        padding: 10px;
      }
      #search-btn {
        height: 30px;
      }
    </style>
    <script>
      function searchByPIN() {
        const pin = document.getElementById('pin').value;
        if (pin) {
          const date = new Date(Date.now())
          const dateString = `${date.getDate()}-${date.getMonth()+1}-${date.getFullYear()}`;

          localStorage.setItem('pin', pin);

          fetch(`https://cdn-api.co-vin.in/api/v2/appointment/sessions/public/calendarByPin?pincode=${pin}&date=${dateString}`)
          .then(res => res.json())
          .then(res => {
            console.log('data', res)
            parseAvailabilityData(res);
          })
          .catch(err => {
            console.error(err);
            alert('Some error occured!');
          })
        }
      }

      function parseAvailabilityData(data) {
        let isAvailable = false;
        data.centers.forEach(center => {
          center.sessions.forEach(session => {
              if (session.min_age_limit == 18 && session.available_capacity > 0) {
                  isAvailable = true;
              }
          })
        })
        alert(isAvailable ? 'Available. Book now!' : 'Sorry, not available');
      }

      (function () {
        window.onload = function () {
          const pin = localStorage.getItem('pin');
          if (pin) {
            document.getElementById('pin').value = pin;
            document.getElementById('search-btn').click();
          }
        }
      })()
    </script>
  </head>
  <body>
    <label for="pin">Pin code</label>
    <input type="text" name="pin" id="pin" placeholder="Enter PIN">
    <button id="search-btn" onclick="searchByPIN()">Search by PIN</button>
  </body>
</html>